<%- include('partials/header') %>

<a href="/translators" class="back-link">&larr; <%= t.translator_detail.back_to_catalog %></a>

<div class="profile-header" style="margin-top:16px;">
  <div class="profile-avatar"><%= translator.name.charAt(0).toUpperCase() %></div>
  <div class="profile-info">
    <h1><%= translator.name %></h1>
    <p class="email"><%= translator.email %></p>
  </div>
</div>

<div class="profile-detail">
  <div class="profile-stats">
    <div class="stat-item">
      <div class="stat-value"><%= translator.languages %></div>
      <div class="stat-label"><%= t.translator_detail.languages %></div>
    </div>
    <div class="stat-item">
      <div class="stat-value"><%= translator.experience_years %></div>
      <div class="stat-label"><%= t.translator_detail.years_experience %></div>
    </div>
    <div class="stat-item">
      <div class="stat-value">$<%= translator.hourly_rate %></div>
      <div class="stat-label"><%= t.translator_detail.hourly_rate %></div>
    </div>
    <div class="stat-item">
      <div class="stat-value rating">&#11088; <%= avg_rating %></div>
      <div class="stat-label"><%= review_count %> <%= t.translator_detail.reviews_label %></div>
    </div>
  </div>
  <% if (translator.bio) { %>
    <div class="profile-bio">
      <strong><%= t.translator_detail.about %></strong>
      <p style="margin-top:8px;"><%= translator.bio %></p>
    </div>
  <% } %>
</div>

<h2><%= t.translator_detail.reviews_title %></h2>

<% if (typeof user !== 'undefined' && user.userRole === 'client') { %>
  <div class="review-form">
    <h3><%= t.translator_detail.leave_review %></h3>
    <form method="POST" action="/reviews">
      <input type="hidden" name="_csrf" value="<%= generateCsrfToken() %>">
      <input type="hidden" name="translator_id" value="<%= translator.id %>">
      <div class="form-group">
        <label for="rating"><%= t.translator_detail.rating %></label>
        <select id="rating" name="rating" required>
          <option value="5">&#11088; <%= t.translator_detail.rating_5 %></option>
          <option value="4">&#11088; <%= t.translator_detail.rating_4 %></option>
          <option value="3">&#11088; <%= t.translator_detail.rating_3 %></option>
          <option value="2">&#11088; <%= t.translator_detail.rating_2 %></option>
          <option value="1">&#11088; <%= t.translator_detail.rating_1 %></option>
        </select>
      </div>
      <div class="form-group">
        <label for="comment"><%= t.translator_detail.comment %></label>
        <textarea id="comment" name="comment" rows="4" placeholder="<%= t.translator_detail.comment_placeholder %>"></textarea>
      </div>
      <button type="submit" class="btn"><%= t.translator_detail.submit_review %></button>
    </form>
  </div>
<% } else if (typeof user === 'undefined' || !user.userId) { %>
  <p style="margin-bottom:16px;"><a href="/auth/login"><%= t.translator_detail.sign_in_to_review %></a> <%= t.translator_detail.to_leave_review %></p>
<% } %>

<% if (reviews.length === 0) { %>
  <div class="empty-state">
    <p><%= t.translator_detail.no_reviews %></p>
  </div>
<% } else { %>
  <div class="reviews-list">
    <% reviews.forEach(function(r) { %>
      <div class="review-card">
        <div class="review-header">
          <span class="review-author"><%= r.client_name %></span>
          <span class="review-rating">&#11088; <%= r.rating %>/5</span>
        </div>
        <p class="review-comment"><%= r.comment %></p>
        <p class="review-date"><%= r.created_at %></p>
      </div>
    <% }); %>
  </div>
<% } %>

<%- include('partials/footer') %>
