<%- include('partials/header') %>

<a href="/translators" class="back-link">&larr; Back to Catalog</a>

<div class="profile-header" style="margin-top:16px;">
  <div class="profile-avatar"><%= translator.name.charAt(0).toUpperCase() %></div>
  <div class="profile-info">
    <h1><%= translator.name %></h1>
    <p class="email"><%= translator.email %></p>
  </div>
</div>

<div class="profile-detail">
  <div class="profile-stats">
    <div class="stat-item">
      <div class="stat-value"><%= translator.languages %></div>
      <div class="stat-label">Languages</div>
    </div>
    <div class="stat-item">
      <div class="stat-value"><%= translator.experience_years %></div>
      <div class="stat-label">Years Experience</div>
    </div>
    <div class="stat-item">
      <div class="stat-value">$<%= translator.hourly_rate %></div>
      <div class="stat-label">Hourly Rate</div>
    </div>
    <div class="stat-item">
      <div class="stat-value rating">&#11088; <%= avg_rating %></div>
      <div class="stat-label"><%= review_count %> Reviews</div>
    </div>
  </div>
  <% if (translator.bio) { %>
    <div class="profile-bio">
      <strong>About</strong>
      <p style="margin-top:8px;"><%= translator.bio %></p>
    </div>
  <% } %>
</div>

<h2>Reviews</h2>

<% if (typeof user !== 'undefined' && user.userRole === 'client') { %>
  <div class="review-form">
    <h3>Leave a Review</h3>
    <form method="POST" action="/reviews">
      <input type="hidden" name="_csrf" value="<%= generateCsrfToken() %>">
      <input type="hidden" name="translator_id" value="<%= translator.id %>">
      <div class="form-group">
        <label for="rating">Rating</label>
        <select id="rating" name="rating" required>
          <option value="5">&#11088; 5 — Excellent</option>
          <option value="4">&#11088; 4 — Good</option>
          <option value="3">&#11088; 3 — Average</option>
          <option value="2">&#11088; 2 — Below Average</option>
          <option value="1">&#11088; 1 — Poor</option>
        </select>
      </div>
      <div class="form-group">
        <label for="comment">Comment</label>
        <textarea id="comment" name="comment" rows="4" placeholder="Share your experience…"></textarea>
      </div>
      <button type="submit" class="btn">Submit Review</button>
    </form>
  </div>
<% } else if (typeof user === 'undefined' || !user.userId) { %>
  <p style="margin-bottom:16px;"><a href="/auth/login">Sign in as a client</a> to leave a review.</p>
<% } %>

<% if (reviews.length === 0) { %>
  <div class="empty-state">
    <p>No reviews yet.</p>
  </div>
<% } else { %>
  <div class="reviews-list">
    <% reviews.forEach(function(r) { %>
      <div class="review-card">
        <div class="review-header">
          <span class="review-author"><%= r.client_name %></span>
          <span class="review-rating">&#11088; <%= r.rating %>/5</span>
        </div>
        <p class="review-comment"><%= r.comment %></p>
        <p class="review-date"><%= r.created_at %></p>
      </div>
    <% }); %>
  </div>
<% } %>

<%- include('partials/footer') %>
